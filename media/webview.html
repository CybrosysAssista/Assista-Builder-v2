<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src 'nonce-{{nonce}}';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assista X</title>
  <meta id="historyAssets" data-css="{{historyCssUri}}" data-js="{{historyJsUri}}">
  <link rel="stylesheet" href="{{historyCssUri}}">
  <link rel="stylesheet" href="{{mainCssUri}}">
</head>
<body>
  <div class="main-content">
    <!-- Welcome Screen (hidden by default; JS will toggle) -->
    <div class="welcome-screen" id="welcomeScreen" aria-hidden="true" style="display:none">
      <div class="ws-logo">
        <div class="ws-logo-badge" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor" aria-hidden="true">
            <path d="M12 2l2.39 4.84L20 8.27l-3.9 3.8.92 5.37L12 15.9l-4.98 2.62.92-5.37L4 8.27l5.61-1.43L12 2z"/>
          </svg>
        </div>
        <h1 class="ws-title">Ask Assista X</h1>
        <p class="ws-sub">Assista X is powered by AI, so mistakes are possible. Review output carefully before use.</p>
      </div>
      <div class="ws-options">
        <button class="ws-card" id="wsNewProjectBtn" type="button">
          <div class="ws-card-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19 3H5a2 2 0 0 0-2 2v3h2V5h14v14h-3v2h3a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/><path d="M3 21h10a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2zm1-9h8v2H4v-2zm0 4h8v2H4v-2z"/></svg>
          </div>
          <span class="ws-card-label">Generate New Project</span>
        </button>
        <button class="ws-card" id="wsEditProjectBtn" type="button">
          <div class="ws-card-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/><path d="M20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>
          </div>
          <span class="ws-card-label">Edit Existing Project</span>
        </button>
      </div>
      <div class="ws-footer">
        <div class="ws-tip"><span>ðŸ“Ž</span><span>or type # to attach context</span></div>
        <div class="ws-tip"><span>@</span><span>to chat with extensions</span></div>
        <div class="ws-tip"><span>/</span><span>to use commands</span></div>
      </div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="progress-panel" id="progressPanel">
      <div class="progress-text" id="progressText">Preparingâ€¦</div>
      <button class="btn secondary" id="progressCancelBtn" style="display:none">Cancel</button>
    </div>
    <div class="history-overlay" id="historyOverlay" aria-hidden="true">
      <div id="historyRoot" style="width:100%; height:100%;"></div>
    </div>
    <div class="settings-overlay" id="settingsOverlay">
      <div class="settings-card">
        <div class="settings-header">
          <span>Assista X â€” Settings</span>
          <button class="btn secondary" id="closeSettingsBtn">Close</button>
        </div>
        <div class="settings-body">
          <div class="field">
            <label>Provider</label>
            <div id="providerTabs" style="display:flex;flex-wrap:wrap;gap:8px"></div>
          </div>
          <div class="field">
            <label for="apiKey">API Key</label>
            <input type="password" id="apiKey" placeholder="Enter API Key" />
          </div>
          <div class="field">
            <label for="model">Model</label>
            <input type="text" id="model" placeholder="e.g., gpt-4o" list="models-datalist" />
            <datalist id="models-datalist"></datalist>
          </div>
          <div class="field" id="customUrlField">
            <label for="customUrl">Custom URL</label>
            <input type="text" id="customUrl" placeholder="https://api.example.com/v1" />
          </div>
          <div id="saveStatus" style="font-size:12px;color:var(--vscode-descriptionForeground);"></div>
        </div>
        <div class="settings-actions">
          <button class="btn secondary" id="cancelSettingsBtn">Cancel</button>
          <button class="btn primary" id="saveSettingsBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="confirm-bar" id="confirmBar" aria-hidden="true">
    <div class="label" id="confirmLabel">Proceed with the planned changes?</div>
    <div class="confirm-actions">
      <button class="btn primary" id="proceedBtn" type="button">Proceed</button>
      <button class="btn ghost" id="cancelBtn" type="button">Cancel</button>
    </div>
  </div>

  <div class="bottom-panel">
    <div class="input-container">
      <div class="input-wrapper">
        <div id="highlightLayer" class="highlight-layer" aria-hidden="true"></div>
        <!-- Keep textarea for JS auto-resize but style it like the compact input -->
        <textarea id="chatInput" class="chat-input" placeholder="Ask anything (Ctrl+L)" rows="2"></textarea>
        <button class="stop-btn" id="stopBtn" title="Stop generation" aria-label="Stop generation" type="button">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2zm-4 6h8v8H8V8z"/></svg>
        </button>
        <!-- Send button kept for JS compatibility; visually we also mirror a right icon below -->
        <button class="send-btn" id="sendBtn" title="Send (Enter)" type="button" aria-label="Send"></button>
      </div>
      <!-- Compact bottom row like the second image -->
      <div class="top-row">
        <div id="contextChips" class="context-chips" aria-live="polite" aria-atomic="true"></div>
        <!-- Mode selector removed as per requirement: no Generate or Edit options shown -->
        <div class="right-buttons">
          <button class="icon-button" id="addContextBtn" title="Add Context" type="button" aria-label="Add Context">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M16.5 6.5l-7.8 7.8a3 3 0 1 0 4.24 4.24l7.42-7.42a5 5 0 1 0-7.07-7.07L5.27 11.08a7 7 0 0 0 9.9 9.9l6.01-6.01" fill="none" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </button>
          <button class="icon-button send-mirror" id="sendBtnMirror" title="Send" type="button" aria-label="Send">
            <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <circle class="send-circle" cx="10" cy="10" r="9"/>
              <path fill="#2d2d30" d="M7.5 6.5l6 3.5-6 3.5V6.5z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
  <script nonce="{{nonce}}" src="{{historyJsUri}}"></script>
  <script nonce="{{nonce}}" src="{{mainJsUri}}"></script>
</body>
</html>
